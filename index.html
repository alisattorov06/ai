<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ali AI v0.1</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
/>


<script>
marked.setOptions({
  breaks: true,
  headerIds: false,
  mangle: false
});
</script>

<style>
:root{
  --bg:#212121;
  --sidebar:#171717;
  --input:#2f2f2f;
  --border:#424242;
  --text:#ececec;
  --muted:#b4b4b4;
}

*{box-sizing:border-box}

body{
  margin:0;
  height:100vh;
  display:flex;
  background:var(--bg);
  font-family:Inter,system-ui;
  color:var(--text);
  overflow:hidden;
}

/* SIDEBAR */
.sidebar{
  width:260px;
  background:var(--sidebar);
  padding:20px;
  display:flex;
  flex-direction:column;
  border-right:1px solid #333;
}
.sidebar h3{
  display:flex;
  align-items:center;
  gap:10px;
}
.sidebar h3::before{
  content:'';
  width:16px;height:16px;
  background:#fff;border-radius:50%;
}
.sidebar div{
  padding:10px 12px;
  border-radius:8px;
  color:var(--muted);
  cursor:pointer;
}
.sidebar div:hover{background:#2f2f2f;color:#fff}

/* MAIN */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* HEADER */
.header{
  padding:16px 24px;
  font-weight:600;
  color:var(--muted);
}

/* MESSAGES */
.messages{
  flex:1;
  overflow-y:auto;
  padding:24px;
  display:flex;
  flex-direction:column;
  gap:20px;
}

/* USER MESSAGE */
.msg-user{
  align-self:flex-end;
  max-width:75%;
  background:#2f2f2f;
  padding:10px 16px;
  border-radius:24px;
  position:relative;
}

/* AI MESSAGE */
.msg-ai{
  align-self:flex-start;
  display:flex;
  gap:14px;
  width:100%;
  position:relative;
}
.ai-icon{
  width:26px;height:26px;
  border-radius:50%;
  background:#333;
  border:1px solid #444;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-shrink:0;
}
.ai-content{
  width:100%;
}

/* COPY BUTTON */
.copy-btn{
  position:absolute;
  top:6px;
  right:6px;
  opacity:0;
  font-size:12px;
  cursor:pointer;
  color:#aaa;
}
.msg-user:hover .copy-btn,
.msg-ai:hover .copy-btn{
  opacity:1;
}

/* INPUT */
.input{
  padding:20px;
}
.input-container{
  display:flex;
  background:var(--input);
  border-radius:26px;
  padding:6px 6px 6px 16px;
  border:1px solid var(--border);
}
.input input{
  flex:1;
  background:transparent;
  border:none;
  color:#fff;
  font-size:16px;
  outline:none;
}
.input button{
  width:36px;height:36px;
  border-radius:50%;
  border:none;
  cursor:pointer;
  background:#fff;
}
.input button.stop{
  background:#ff4d4d;
  color:white;
}

/* MOBILE */
@media(max-width:768px){
  .sidebar{display:none}
}
</style>
</head>

<body>

<div class="sidebar">
  <h3>Ali AI v0.1</h3>
  <div>+ Yangi chat</div>
  <div style="margin-top:auto;border-top:1px solid #333;padding-top:16px;">Sozlamalar</div>
</div>

<div class="main">
  <div class="header">Ali AI v0.1</div>

  <div class="messages" id="messages"></div>

  <div class="input">
    <div class="input-container">
      <input id="input" placeholder="Xabar yozing...">
      <button id="sendBtn" onclick="handleSend()"><i class="fa-solid fa-rocket"></i>

</button>
    </div>
  </div>
</div>

<script>
const messages = document.getElementById("messages");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");

let typingInterval = null;
let isTyping = false;

/* SCROLL */
function scrollBottom(){
  messages.scrollTop = messages.scrollHeight;
}

/* COPY */
function copyText(text){
  navigator.clipboard.writeText(text);
}

/* ADD USER */
function addUser(text){
  const div=document.createElement("div");
  div.className="msg-user";
  div.innerHTML = `
    ${text}
    <span class="copy-btn" onclick="copyText('${text.replace(/'/g,"\\'")}')"><i class="fa-regular fa-copy"></i>
</span>
  `;
  messages.appendChild(div);
  scrollBottom();
}

/* ADD AI CONTAINER */
function addAI(){
  const wrap=document.createElement("div");
  wrap.className="msg-ai";
  wrap.innerHTML=`
    <div class="ai-icon">✦</div>
    <div class="ai-content"></div>
    <span class="copy-btn"><i class="fa-regular fa-copy"></i></span>
  `;
  messages.appendChild(wrap);
  scrollBottom();
  return wrap.querySelector(".ai-content");
}

/* TYPING EFFECT */
function typeText(el, text){
  let i=0;
  isTyping=true;
  sendBtn.textContent="⏹";
  sendBtn.classList.add("stop");

  typingInterval=setInterval(()=>{
    el.innerHTML = marked.parse(text.slice(0,i++));
    scrollBottom();
    if(i>text.length){
      stopTyping();
    }
  },15);
}

/* STOP */
function stopTyping(){
  clearInterval(typingInterval);
  isTyping=false;
  sendBtn.textContent="↑";
  sendBtn.classList.remove("stop");
}

/* SEND */
async function handleSend(){
  if(isTyping){
    stopTyping();
    return;
  }

  const text=input.value.trim();
  if(!text)return;

  input.value="";
  addUser(text);

  const aiBox = addAI();

  try{
    const r=await fetch("http://127.0.0.1:8000/chat",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({message:text})
    });
    const d=await r.json();
    typeText(aiBox, d.reply);
  }catch{
    typeText(aiBox, "Server bilan aloqa yo‘q");
  }
}

/* ENTER */
input.addEventListener("keydown",e=>{
  if(e.key==="Enter")handleSend();
});

/* WELCOME */
addAI();
typeText(document.querySelector(".ai-content"),"Salom! Men Ali AI v0.1. Sizga qanday yordam bera olaman?");
</script>

</body>
</html>
